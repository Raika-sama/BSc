{"level":"info","message":"Inizializzazione modelli in corso...","timestamp":"2025-02-28T19:17:41.065Z"}
{"level":"info","message":"Tutti i modelli sono stati caricati con successo","timestamp":"2025-02-28T19:17:41.132Z"}
{"level":"info","message":"MongoDB Connected: cluster0-shard-00-01.4nf56.mongodb.net","timestamp":"2025-02-28T19:17:42.163Z"}
{"level":"info","message":"Database connesso con successo","timestamp":"2025-02-28T19:17:42.165Z"}
{"level":"info","message":"Tutti i modelli richiesti sono registrati correttamente","timestamp":"2025-02-28T19:17:42.167Z"}
{"environment":"development","level":"info","message":"Routes initialized:","protected":["/classes","/schools","/users","/students","/tests"],"public":["/auth","/student-auth","/tests/csi/public"],"timestamp":"2025-02-28T19:17:42.514Z"}
{"level":"info","message":"Server in esecuzione su localhost:5000","timestamp":"2025-02-28T19:17:42.521Z"}
{"level":"info","message":"Ambiente: development","timestamp":"2025-02-28T19:17:42.522Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/verify","timestamp":"2025-02-28T19:18:20.382Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Auth Error:","method":"GET","path":"/api/v1/auth/verify","timestamp":"2025-02-28T19:18:20.383Z"}
{"duration":"13ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740770300375_ypl7se6ha","responseSize":"144 Bytes","statusCode":500,"timestamp":"2025-02-28T19:18:20.390Z","url":"/api/v1/auth/verify","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/logout","timestamp":"2025-02-28T19:18:20.406Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Auth Error:","method":"POST","path":"/api/v1/auth/logout","timestamp":"2025-02-28T19:18:20.407Z"}
{"duration":"4ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740770300404_c8fvn5bnb","responseSize":"144 Bytes","statusCode":500,"timestamp":"2025-02-28T19:18:20.408Z","url":"/api/v1/auth/logout","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"level":"info","message":"Login successful","metadata":{"ipAddress":"::1","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"},"timestamp":"2025-02-28T19:18:32.748Z","userId":"677bfe44f6789c907c9f3766"}
{"classesUpdated":0,"level":"info","message":"Utente rimosso con successo dalla scuola","schoolId":"679fdad474255ebc8afab683","studentsUpdated":0,"timestamp":"2025-02-28T19:53:12.595Z","userId":"67c0c560285a82c16495c615"}
{"level":"error","message":"ID utente non valido","metadata":{},"timestamp":"2025-02-28T19:53:44.291Z"}
{"duration":"182ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740772424113_h740s8ok1","responseSize":"92 Bytes","statusCode":500,"timestamp":"2025-02-28T19:53:44.295Z","url":"/api/v1/users/create","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/verify","timestamp":"2025-02-28T20:28:32.606Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Auth Error:","method":"GET","path":"/api/v1/auth/verify","timestamp":"2025-02-28T20:28:32.609Z"}
{"duration":"42ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740774512579_kzb9hj8vq","responseSize":"144 Bytes","statusCode":500,"timestamp":"2025-02-28T20:28:32.623Z","url":"/api/v1/auth/verify","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/logout","timestamp":"2025-02-28T20:28:32.633Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Auth Error:","method":"POST","path":"/api/v1/auth/logout","timestamp":"2025-02-28T20:28:32.634Z"}
{"duration":"7ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740774512629_p6tym3kzg","responseSize":"144 Bytes","statusCode":500,"timestamp":"2025-02-28T20:28:32.636Z","url":"/api/v1/auth/logout","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"level":"info","message":"Login successful","metadata":{"ipAddress":"::1","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"},"timestamp":"2025-02-28T20:28:55.268Z","userId":"677bfe44f6789c907c9f3766"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/","timestamp":"2025-02-28T21:37:30.646Z"}
{"body":{},"error":{"message":"Autenticazione richiesta"},"level":"error","message":"Errore richiesta","method":"GET","query":{"institutionType":"","limit":"10","page":"1","populate":"manager","region":"","schoolType":""},"requestId":"req_1740778650634_kifgnbczn","timestamp":"2025-02-28T21:37:30.657Z","url":"/api/v1/schools?page=1&limit=10&populate=manager&region=&schoolType=&institutionType="}
{"level":"error","message":"Autenticazione richiesta","timestamp":"2025-02-28T21:37:30.661Z"}
{"duration":"34ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740778650634_kifgnbczn","responseSize":"160 Bytes","statusCode":500,"timestamp":"2025-02-28T21:37:30.669Z","url":"/api/v1/schools?page=1&limit=10&populate=manager&region=&schoolType=&institutionType=","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/verify","timestamp":"2025-02-28T21:37:36.214Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Auth Error:","method":"GET","path":"/api/v1/auth/verify","timestamp":"2025-02-28T21:37:36.221Z"}
{"duration":"18ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740778656211_p4yxqj1fr","responseSize":"144 Bytes","statusCode":500,"timestamp":"2025-02-28T21:37:36.229Z","url":"/api/v1/auth/verify","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Authentication failed","path":"/logout","timestamp":"2025-02-28T21:37:36.238Z"}
{"error":{"message":"Autenticazione richiesta","metadata":{}},"ip":"::1","level":"error","message":"Auth Error:","method":"POST","path":"/api/v1/auth/logout","timestamp":"2025-02-28T21:37:36.240Z"}
{"duration":"7ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740778656235_49dn1nv66","responseSize":"144 Bytes","statusCode":500,"timestamp":"2025-02-28T21:37:36.242Z","url":"/api/v1/auth/logout","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"level":"info","message":"Login successful","metadata":{"ipAddress":"::1","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"},"timestamp":"2025-02-28T21:37:40.578Z","userId":"677bfe44f6789c907c9f3766"}
{"level":"warn","message":"Route not found:","method":"GET","path":"/api/v1/users/67c0c5d1285a82c16495c6dc/history","timestamp":"2025-02-28T21:59:40.759Z"}
{"duration":"149ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740779980619_11qyadukq","responseSize":"95 Bytes","statusCode":404,"timestamp":"2025-02-28T21:59:40.768Z","url":"/api/v1/users/67c0c5d1285a82c16495c6dc/history","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"classesUpdated":0,"level":"info","message":"Utente rimosso con successo dalla scuola","schoolId":"679fdad474255ebc8afab683","studentsUpdated":0,"timestamp":"2025-02-28T22:12:14.405Z","userId":"67c0c560285a82c16495c615"}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:12:16.828Z","wasAlsoUser":false}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:12:16.829Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"info","message":"Inizializzazione modelli in corso...","timestamp":"2025-02-28T22:18:17.391Z"}
{"level":"info","message":"Tutti i modelli sono stati caricati con successo","timestamp":"2025-02-28T22:18:17.441Z"}
{"level":"info","message":"MongoDB Connected: cluster0-shard-00-01.4nf56.mongodb.net","timestamp":"2025-02-28T22:18:18.398Z"}
{"level":"info","message":"Database connesso con successo","timestamp":"2025-02-28T22:18:18.400Z"}
{"level":"info","message":"Tutti i modelli richiesti sono registrati correttamente","timestamp":"2025-02-28T22:18:18.401Z"}
{"environment":"development","level":"info","message":"Routes initialized:","protected":["/classes","/schools","/users","/students","/tests"],"public":["/auth","/student-auth","/tests/csi/public"],"timestamp":"2025-02-28T22:18:18.833Z"}
{"level":"info","message":"Server in esecuzione su localhost:5000","timestamp":"2025-02-28T22:18:18.842Z"}
{"level":"info","message":"Ambiente: development","timestamp":"2025-02-28T22:18:18.842Z"}
{"error":"La scuola ha già un manager","level":"error","message":"Errore nell'aggiunta del manager:","schoolId":"67a7a35c242b430cbd8c5791","timestamp":"2025-02-28T22:18:28.607Z"}
{"duration":"183ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740781108426_bj5x94qn1","responseSize":"86 Bytes","statusCode":500,"timestamp":"2025-02-28T22:18:28.609Z","url":"/api/v1/schools/67a7a35c242b430cbd8c5791/add-manager","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"academicYear":"2024/2025","level":"info","message":"Inizializzazione classi per la scuola","schoolId":"67c236a42373b42426264bf6","sectionsCount":1,"timestamp":"2025-02-28T22:20:20.429Z"}
{"classesCreated":5,"level":"info","message":"Classi iniziali create con successo","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:20:20.733Z"}
{"level":"info","message":"Manager rimosso con successo e assignedSchoolId resettato","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:20:31.071Z","wasAlsoUser":false}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:20:31.072Z","updatedSchool":"67c236a42373b42426264bf6"}
{"level":"info","message":"Manager aggiunto con successo con assignedSchoolId","newManagerId":"67c0296a250c5746c3d96444","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:20:35.486Z"}
{"level":"info","message":"Manager aggiunto con successo","newManagerId":"67c0296a250c5746c3d96444","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:20:35.488Z","updatedSchool":"67c236a42373b42426264bf6"}
{"level":"info","message":"Manager rimosso con successo e assignedSchoolId resettato","oldManagerId":"67c0296a250c5746c3d96444","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:21:15.977Z","wasAlsoUser":true}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"67c0296a250c5746c3d96444","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:21:15.978Z","updatedSchool":"67c236a42373b42426264bf6"}
{"level":"info","message":"Manager aggiunto con successo con assignedSchoolId","newManagerId":"67c0296a250c5746c3d96444","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:21:54.983Z"}
{"level":"info","message":"Manager aggiunto con successo","newManagerId":"67c0296a250c5746c3d96444","schoolId":"67c236a42373b42426264bf6","timestamp":"2025-02-28T22:21:54.983Z","updatedSchool":"67c236a42373b42426264bf6"}
{"level":"info","message":"Inizializzazione modelli in corso...","timestamp":"2025-02-28T22:23:42.254Z"}
{"level":"info","message":"Tutti i modelli sono stati caricati con successo","timestamp":"2025-02-28T22:23:42.303Z"}
{"level":"info","message":"MongoDB Connected: cluster0-shard-00-02.4nf56.mongodb.net","timestamp":"2025-02-28T22:23:43.030Z"}
{"level":"info","message":"Database connesso con successo","timestamp":"2025-02-28T22:23:43.031Z"}
{"level":"info","message":"Tutti i modelli richiesti sono registrati correttamente","timestamp":"2025-02-28T22:23:43.033Z"}
{"environment":"development","level":"info","message":"Routes initialized:","protected":["/classes","/schools","/users","/students","/tests"],"public":["/auth","/student-auth","/tests/csi/public"],"timestamp":"2025-02-28T22:23:43.314Z"}
{"level":"info","message":"Server in esecuzione su localhost:5000","timestamp":"2025-02-28T22:23:43.320Z"}
{"level":"info","message":"Ambiente: development","timestamp":"2025-02-28T22:23:43.320Z"}
{"level":"info","message":"Inizializzazione modelli in corso...","timestamp":"2025-02-28T22:32:46.690Z"}
{"level":"info","message":"Tutti i modelli sono stati caricati con successo","timestamp":"2025-02-28T22:32:46.749Z"}
{"level":"info","message":"MongoDB Connected: cluster0-shard-00-01.4nf56.mongodb.net","timestamp":"2025-02-28T22:32:48.712Z"}
{"level":"info","message":"Database connesso con successo","timestamp":"2025-02-28T22:32:48.713Z"}
{"level":"info","message":"Tutti i modelli richiesti sono registrati correttamente","timestamp":"2025-02-28T22:32:48.714Z"}
{"environment":"development","level":"info","message":"Routes initialized:","protected":["/classes","/schools","/users","/students","/tests"],"public":["/auth","/student-auth","/tests/csi/public"],"timestamp":"2025-02-28T22:32:49.070Z"}
{"level":"info","message":"Server in esecuzione su localhost:5000","timestamp":"2025-02-28T22:32:49.079Z"}
{"level":"info","message":"Ambiente: development","timestamp":"2025-02-28T22:32:49.079Z"}
{"level":"info","message":"Manager aggiunto con successo con assignedSchoolIds aggiornato","newManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:33:07.508Z"}
{"level":"info","message":"Manager aggiunto con successo","newManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:33:07.509Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"info","message":"Manager rimosso con successo e assignedSchoolIds aggiornato","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:33:27.559Z","wasAlsoUser":true}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:33:27.560Z","updatedSchool":"679fdad474255ebc8afab683"}
{"error":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","level":"error","message":"Session validation error","stack":"ValidationError: User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"\n    at Document.invalidate (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:3219:32)\n    at _init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:791:18)\n    at init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:737:5)\n    at Document.$__init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:693:3)\n    at model.syncWrapper [as $__init] (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\kareem\\index.js:331:25)\n    at Document.init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:637:8)\n    at Document.$init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:653:42)\n    at Object.createModelAndInit (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\queryhelpers.js:138:12)\n    at completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:3142:11)\n    at Query._completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:2501:7)","timestamp":"2025-02-28T22:34:00.322Z"}
{"error":{"_message":"User validation failed","errors":{"assignedSchoolIds":{"kind":"cast","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidatorError","path":"assignedSchoolIds","properties":{"message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","path":"assignedSchoolIds","reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"type":"cast","value":[]},"reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"value":[]}},"message":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidationError"},"ip":"::1","level":"error","message":"Authentication failed","path":"/verify","timestamp":"2025-02-28T22:34:00.323Z"}
{"error":{"_message":"User validation failed","errors":{"assignedSchoolIds":{"kind":"cast","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidatorError","path":"assignedSchoolIds","properties":{"message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","path":"assignedSchoolIds","reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"type":"cast","value":[]},"reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"value":[]}},"message":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidationError"},"ip":"::1","level":"error","message":"Auth Error:","method":"GET","path":"/api/v1/auth/verify","timestamp":"2025-02-28T22:34:00.326Z"}
{"duration":"38ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740782040290_4gfn5250i","responseSize":"1.47 KB","statusCode":500,"timestamp":"2025-02-28T22:34:00.328Z","url":"/api/v1/auth/verify","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"error":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","level":"error","message":"Session validation error","stack":"ValidationError: User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"\n    at Document.invalidate (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:3219:32)\n    at _init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:791:18)\n    at init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:737:5)\n    at Document.$__init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:693:3)\n    at model.syncWrapper [as $__init] (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\kareem\\index.js:331:25)\n    at Document.init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:637:8)\n    at Document.$init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:653:42)\n    at Object.createModelAndInit (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\queryhelpers.js:138:12)\n    at completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:3142:11)\n    at Query._completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:2501:7)","timestamp":"2025-02-28T22:34:00.362Z"}
{"error":{"_message":"User validation failed","errors":{"assignedSchoolIds":{"kind":"cast","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidatorError","path":"assignedSchoolIds","properties":{"message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","path":"assignedSchoolIds","reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"type":"cast","value":[]},"reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"value":[]}},"message":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidationError"},"ip":"::1","level":"error","message":"Authentication failed","path":"/logout","timestamp":"2025-02-28T22:34:00.363Z"}
{"error":{"_message":"User validation failed","errors":{"assignedSchoolIds":{"kind":"cast","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidatorError","path":"assignedSchoolIds","properties":{"message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","path":"assignedSchoolIds","reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"type":"cast","value":[]},"reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"value":[]}},"message":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidationError"},"ip":"::1","level":"error","message":"Auth Error:","method":"POST","path":"/api/v1/auth/logout","timestamp":"2025-02-28T22:34:00.366Z"}
{"duration":"38ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740782040332_cb4l6dkk6","responseSize":"1.47 KB","statusCode":500,"timestamp":"2025-02-28T22:34:00.370Z","url":"/api/v1/auth/logout","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"email":"riccardonicolilb@gmail.com","error":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","level":"error","message":"Login error:","stack":"ValidationError: User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"\n    at Document.invalidate (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:3219:32)\n    at _init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:791:18)\n    at init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:737:5)\n    at Document.$__init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:693:3)\n    at model.syncWrapper [as $__init] (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\kareem\\index.js:331:25)\n    at Document.init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:637:8)\n    at Document.$init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:653:42)\n    at Object.createModelAndInit (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\queryhelpers.js:138:12)\n    at completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:3142:11)\n    at Query._completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:2501:7)","timestamp":"2025-02-28T22:34:02.083Z"}
{"error":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","level":"error","message":"Login error:","stack":"ValidationError: User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"\n    at Document.invalidate (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:3219:32)\n    at _init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:791:18)\n    at init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:737:5)\n    at Document.$__init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:693:3)\n    at model.syncWrapper [as $__init] (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\kareem\\index.js:331:25)\n    at Document.init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:637:8)\n    at Document.$init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:653:42)\n    at Object.createModelAndInit (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\queryhelpers.js:138:12)\n    at completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:3142:11)\n    at Query._completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:2501:7)","timestamp":"2025-02-28T22:34:02.085Z"}
{"error":{"_message":"User validation failed","errors":{"assignedSchoolIds":{"kind":"cast","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidatorError","path":"assignedSchoolIds","properties":{"message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","path":"assignedSchoolIds","reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"type":"cast","value":[]},"reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"value":[]}},"message":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidationError"},"ip":"::1","level":"error","message":"Auth Error:","method":"POST","path":"/api/v1/auth/login","timestamp":"2025-02-28T22:34:02.086Z"}
{"duration":"179ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740782041909_0bkjrrx53","responseSize":"1.47 KB","statusCode":500,"timestamp":"2025-02-28T22:34:02.088Z","url":"/api/v1/auth/login","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"email":"riccardonicolilb@gmail.com","error":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","level":"error","message":"Login error:","stack":"ValidationError: User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"\n    at Document.invalidate (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:3219:32)\n    at _init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:791:18)\n    at init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:737:5)\n    at Document.$__init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:693:3)\n    at model.syncWrapper [as $__init] (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\kareem\\index.js:331:25)\n    at Document.init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:637:8)\n    at Document.$init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:653:42)\n    at Object.createModelAndInit (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\queryhelpers.js:138:12)\n    at completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:3142:11)\n    at Query._completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:2501:7)","timestamp":"2025-02-28T22:34:12.516Z"}
{"error":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","level":"error","message":"Login error:","stack":"ValidationError: User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"\n    at Document.invalidate (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:3219:32)\n    at _init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:791:18)\n    at init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:737:5)\n    at Document.$__init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:693:3)\n    at model.syncWrapper [as $__init] (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\kareem\\index.js:331:25)\n    at Document.init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:637:8)\n    at Document.$init (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\document.js:653:42)\n    at Object.createModelAndInit (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\queryhelpers.js:138:12)\n    at completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:3142:11)\n    at Query._completeOne (C:\\Users\\ricca\\Desktop\\BSc\\node_modules\\mongoose\\lib\\query.js:2501:7)","timestamp":"2025-02-28T22:34:12.517Z"}
{"error":{"_message":"User validation failed","errors":{"assignedSchoolIds":{"kind":"cast","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidatorError","path":"assignedSchoolIds","properties":{"message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","path":"assignedSchoolIds","reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"type":"cast","value":[]},"reason":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"CastError","path":"assignedSchoolIds","reason":{},"stringValue":"\"[]\"","value":[],"valueType":"Array"},"value":[]}},"message":"User validation failed: assignedSchoolIds: Cast to ObjectId failed for value \"[]\" (type Array) at path \"assignedSchoolIds\" because of \"BSONError\"","name":"ValidationError"},"ip":"::1","level":"error","message":"Auth Error:","method":"POST","path":"/api/v1/auth/login","timestamp":"2025-02-28T22:34:12.518Z"}
{"duration":"123ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"POST","requestId":"req_1740782052396_posoz9suo","responseSize":"1.47 KB","statusCode":500,"timestamp":"2025-02-28T22:34:12.519Z","url":"/api/v1/auth/login","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"level":"info","message":"Inizializzazione modelli in corso...","timestamp":"2025-02-28T22:36:35.416Z"}
{"level":"info","message":"Tutti i modelli sono stati caricati con successo","timestamp":"2025-02-28T22:36:35.465Z"}
{"level":"info","message":"MongoDB Connected: cluster0-shard-00-00.4nf56.mongodb.net","timestamp":"2025-02-28T22:36:36.172Z"}
{"level":"info","message":"Database connesso con successo","timestamp":"2025-02-28T22:36:36.173Z"}
{"level":"info","message":"Tutti i modelli richiesti sono registrati correttamente","timestamp":"2025-02-28T22:36:36.174Z"}
{"environment":"development","level":"info","message":"Routes initialized:","protected":["/classes","/schools","/users","/students","/tests"],"public":["/auth","/student-auth","/tests/csi/public"],"timestamp":"2025-02-28T22:36:36.512Z"}
{"level":"info","message":"Server in esecuzione su localhost:5000","timestamp":"2025-02-28T22:36:36.516Z"}
{"level":"info","message":"Ambiente: development","timestamp":"2025-02-28T22:36:36.516Z"}
{"level":"info","message":"Login successful","metadata":{"ipAddress":"::1","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"},"timestamp":"2025-02-28T22:36:41.813Z","userId":"677bfe44f6789c907c9f3766"}
{"level":"info","message":"Manager aggiunto con successo con assignedSchoolIds aggiornato","newManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:36:49.318Z"}
{"level":"info","message":"Manager aggiunto con successo","newManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:36:49.319Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"info","message":"Manager rimosso con successo e assignedSchoolIds aggiornato","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:37:04.135Z","wasAlsoUser":true}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"677bfe44f6789c907c9f3766","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:37:04.136Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"info","message":"Manager aggiunto con successo con assignedSchoolIds aggiornato","newManagerId":"67c0c5d1285a82c16495c6dc","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:37:09.024Z"}
{"level":"info","message":"Manager aggiunto con successo","newManagerId":"67c0c5d1285a82c16495c6dc","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:37:09.025Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"info","message":"User updated successfully","timestamp":"2025-02-28T22:38:27.162Z","userId":"67c0c5d1285a82c16495c6dc"}
{"level":"info","message":"User updated successfully","testAccessLevel":2,"timestamp":"2025-02-28T22:38:27.163Z","updatedFields":["permissions","testAccessLevel","hasAdminAccess"],"userId":"67c0c5d1285a82c16495c6dc"}
{"level":"info","message":"User updated","timestamp":"2025-02-28T22:38:27.163Z","userId":"67c0c5d1285a82c16495c6dc"}
{"level":"warn","message":"Tentativo di rimuovere l'ultimo admin della scuola","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:49:32.094Z","userId":"67c0c5d1285a82c16495c6dc"}
{"error":"Impossibile rimuovere l'ultimo admin della scuola","level":"error","message":"Errore nella rimozione dell'utente dalla scuola:","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:49:32.113Z","userId":"67c0c5d1285a82c16495c6dc"}
{"error":"Impossibile rimuovere l'ultimo admin della scuola","level":"error","message":"Errore nella rimozione dell'utente dalla scuola:","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:49:32.114Z","userId":"67c0c5d1285a82c16495c6dc"}
{"duration":"195ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"DELETE","requestId":"req_1740782971920_kus27yn4r","responseSize":"107 Bytes","statusCode":500,"timestamp":"2025-02-28T22:49:32.116Z","url":"/api/v1/schools/679fdad474255ebc8afab683/users","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
{"level":"info","message":"Manager rimosso con successo e assignedSchoolIds aggiornato","oldManagerId":"67c0c5d1285a82c16495c6dc","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:49:44.730Z","wasAlsoUser":true}
{"level":"info","message":"Manager rimosso con successo","oldManagerId":"67c0c5d1285a82c16495c6dc","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:49:44.731Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"info","message":"Manager aggiunto con successo con assignedSchoolIds aggiornato","newManagerId":"67c0c5d1285a82c16495c6dc","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:51:38.359Z"}
{"level":"info","message":"Manager aggiunto con successo","newManagerId":"67c0c5d1285a82c16495c6dc","schoolId":"679fdad474255ebc8afab683","timestamp":"2025-02-28T22:51:38.360Z","updatedSchool":"679fdad474255ebc8afab683"}
{"level":"warn","message":"Route not found:","method":"GET","path":"/api/v1/users/67c0c5d1285a82c16495c6dc/history","timestamp":"2025-02-28T22:59:22.743Z"}
{"duration":"190ms","ip":"::1","level":"warn","message":"Risposta inviata","method":"GET","requestId":"req_1740783562556_q5dvhr47h","responseSize":"95 Bytes","statusCode":404,"timestamp":"2025-02-28T22:59:22.746Z","url":"/api/v1/users/67c0c5d1285a82c16495c6dc/history","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/133.0.0.0"}
